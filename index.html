<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Constant Sum Survey</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better aesthetics */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Ensure number inputs show spinners */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
          opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-lg">

        <h1 class="text-2xl font-bold text-gray-800 mb-4 text-center">Smartphone Feature Survey</h1>

        <div class="mb-6">
            <label for="name-input" class="block text-md font-semibold text-gray-700 mb-2">
                What is your name?
            </label>
            <input type="text" id="name-input" name="name" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" placeholder="Jane Doe">
        </div>

        <div class="mb-6">
            <label class="block text-md font-semibold text-gray-700 mb-3">
                Please allocate 100 points among the following smartphone features based on their importance to you.
            </label>
            <p class="text-sm text-gray-500 mb-4">The total must be exactly 100.</p>

            <div id="survey-form" class="space-y-4">
                <div class="flex items-center justify-between space-x-4">
                    <label for="camera" class="text-gray-700 w-1/3">Camera Quality</label>
                    <input type="number" id="camera" name="camera" min="0" max="100" value="0" class="survey-input w-2/3 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div class="flex items-center justify-between space-x-4">
                    <label for="battery" class="text-gray-700 w-1/3">Battery Life</label>
                    <input type="number" id="battery" name="battery" min="0" max="100" value="0" class="survey-input w-2/3 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div class="flex items-center justify-between space-x-4">
                    <label for="screen" class="text-gray-700 w-1/3">Screen Size</label>
                    <input type="number" id="screen" name="screen" min="0" max="100" value="0" class="survey-input w-2/3 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div class="flex items-center justify-between space-x-4">
                    <label for="price" class="text-gray-700 w-1/3">Price</label>
                    <input type="number" id="price" name="price" min="0" max="100" value="0" class="survey-input w-2/3 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>

                <div class="flex items-center justify-between space-x-4">
                    <label for="storage" class="text-gray-700 w-1/3">Storage Space</label>
                    <input type="number" id="storage" name="storage" min="0" max="100" value="0" class="survey-input w-2/3 p-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>
        </div>

        <div class="mb-6 p-4 bg-gray-50 rounded-lg">
            <div class="flex justify-between items-center">
                <span class="text-lg font-bold text-gray-800">Total Points:</span>
                <span id="total-points" class="text-lg font-bold text-gray-800">0</span>
            </div>
            <div id="validation-message" class="text-center mt-2 text-sm font-medium"></div>
        </div>

        <button id="submit-btn" type="button" class="w-full bg-blue-600 text-white py-3 px-4 rounded-md font-semibold shadow-md transition-all duration-200 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
            Submit
        </button>

        <div id="success-message" class="hidden mt-4 p-4 bg-green-100 text-green-700 border border-green-300 rounded-md text-center">
            Thank you! Your survey has been submitted.
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const inputs = document.querySelectorAll('.survey-input');
            const totalPointsEl = document.getElementById('total-points');
            const validationMessageEl = document.getElementById('validation-message');
            const submitBtn = document.getElementById('submit-btn');
            const successMessage = document.getElementById('success-message');
            const surveyForm = document.getElementById('survey-form');

            const updateTotal = () => {
                let total = 0;
                inputs.forEach(input => {
                    // Ensure we treat empty strings as 0
                    const value = parseInt(input.value, 10) || 0;
                    // Ensure non-negative values
                    if (value < 0) {
                        input.value = 0;
                    }
                    total += value;
                });

                totalPointsEl.textContent = total;

                // Validation logic
                if (total === 100) {
                    validationMessageEl.textContent = 'Total is exactly 100!';
                    validationMessageEl.className = 'text-center mt-2 text-sm font-medium text-green-600';
                    totalPointsEl.className = 'text-lg font-bold text-green-600';
                    submitBtn.disabled = false;
                } else if (total > 100) {
                    validationMessageEl.textContent = `Total is ${total}. Please reduce by ${total - 100}.`;
                    validationMessageEl.className = 'text-center mt-2 text-sm font-medium text-red-600';
                    totalPointsEl.className = 'text-lg font-bold text-red-600';
                    submitBtn.disabled = true;
                } else {
                    validationMessageEl.textContent = `Total is ${total}. Please add ${100 - total} more.`;
                    validationMessageEl.className = 'text-center mt-2 text-sm font-medium text-yellow-600';
                    totalPointsEl.className = 'text-lg font-bold text-yellow-600';
                    submitBtn.disabled = true;
                }
            };

            // Add event listener to each input
            inputs.forEach(input => {
                input.addEventListener('input', updateTotal);
            });

            // Handle form submission
            submitBtn.addEventListener('click', () => {
                // *** 1. PASTE YOUR GOOGLE SCRIPT URL HERE ***
                const scriptURL = 'https://script.google.com/macros/s/AKfycbyjKsKXMIACjbHc5Mql_z1RnAXW1qnadueLQtXg2RAAx1Y_wGgsISavutYKCVlmITBy/exec';

                // Get the name value
                const name = document.getElementById('name-input')?.value || 'Not provided';

                // Construct the data object
                const formData = {
                    name: name
                };
                inputs.forEach(input => {
                    formData[input.name] = parseInt(input.value, 10) || 0;
                });

                // Disable button and show "Submitting..."
                submitBtn.disabled = true;
                submitBtn.textContent = 'Submitting...';

                // Send data to Google Apps Script
                fetch(scriptURL, {
                    method: 'POST',
                    mode: 'cors', // 'cors' is needed for cross-domain requests
                    headers: {
                        // Apps Script web apps often prefer text/plain
                        'Content-Type': 'text/plain;charset=utf-8',
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    // Hide the form and button, show success
                    document.getElementById('name-input').parentElement.classList.add('hidden'); // Hide name question
                    surveyForm.classList.add('hidden');
                    submitBtn.classList.add('hidden');
                    validationMessageEl.classList.add('hidden');
                    document.querySelector('.bg-gray-50').classList.add('hidden'); // Hide total box

                    successMessage.classList.remove('hidden');
                })
                .catch(error => {
                    console.error('Error!', error.message);
                    // Show an error to the user
                    validationMessageEl.textContent = 'Error: Could not submit. Please check your script URL and connection.';
                    validationMessageEl.className = 'text-center mt-2 text-sm font-medium text-red-600';

                    // Re-enable the button
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Submit';
                });
            });

            // Initial check on load
            updateTotal();
        });
    </script>

</body>
</html>
